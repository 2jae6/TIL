### 포카마켓 iOS 팀 브렌치 전략


### Github Flow
처음 팀 빌딩을 시작할 때 브렌치 전략을 많이 찾아봤었다. 지금은 다양한 브렌치 전략이 있지만 몇 년 전만 해도 git-flow 전략 외에는 유명하지 않았던 것 같았다. 그 때 스타트업이었던 우리 조직에게 git-flow 는 너무 과하게 브렌치를 사용하는 전략이었고 빠른 개발이 필요했어서 다른 전략을 알아보다가 Github Flow 를 알게되었다. trunk-based development 전략도 같이 참고해서 진행하였다.
하나의 브렌치에서 마이크로 PR 및 코드리뷰를 할 수 있는 장점이 있다고 생각했고, 소수의 인원인 우리에게는 적합한 전략이라고 생각이 들었다. 바로 마스터 브렌치에 병합하는만큼 마스터 브렌치의 무결성을 보장하기위해 CI/CD 를 도입했었다.
(초기에는 Xcode Cloud, 현재는 Github Action)

### 문제점
제품팀(국내 사일로)의 개발 진행 방식이 대형 프로젝트(약 3개월)를 진행하면서 3주마다 작은 기능들을 배포하는 방식이었는데 3개월 대형 프로젝트에서 추가 된 기능이 3주 배포건에는 반영되면 안되는 문제들이 발생하였다. 해당 업무 방식과 브렌치 전략이 유연하게 대처할 수 없는 전략이라 배포에 어려움 및 핫픽스 건이 발생했을 때 문제가 생기게 된다.

### 대안
이를 해결 할 수 있고, 우리와 어울리는 여러 방안 찾아보고 생각해보았다.
https://blog.banksalad.com/tech/how-banksalad-safely-deploys-mobile-app/

최종적으로 참고했던 뱅크샐러드의 브렌치 전략이었다.
간략히 요약하면 마스터 브렌치와 Release 브렌치를 두고 필요한 커밋들을 체리픽 해오는 방식이었다.
마스터 브렌치에서는 github-flow 와 같이 모든 피처들이 담긴 브렌치이며, 릴리즈 브렌치는 현재 배포된 버전의 브렌치이다.

이 전략을 취하면서 중요하게 생각했던 포인트들은 다음과 같다.
1. 체리픽이 가능할 정도로 커밋을 나눠야한다. 그래야 반영할지 안할지 구분이 가능하므로.
2. 배포 시에 릴리즈 브렌치에 반영이 커밋인지 확인 할 방법이 필요하다.
3. 마이크로 PR 을 지향하다보니 체리픽을 놓치고 배포되는 일이 있을 수 있다.


이 전략의 문제점은 release 브렌치와 develop 브렌치가 체리픽 시 충돌이나는 것들이 문제로 다뤄진다. 또한 휴먼 에러가 발생할 수 있는 가능성이 체리픽 시 있을 수 있어 꼼꼼한 확인이 필요하다.

### 문제점

제가 생각했을 때 이 브렌치 전략을 운용하면서 어려웠던 점은 다음과 같습니다.
1. 브렌치 전략이 심플하지 못합니다. 체리픽으로 반영 사항들은 사람이 선택해서 가져온다는 것은 언젠가 휴먼 에러를 발생 시킬 수 있습니다.
2. 배포주기가 생각보다 긴 저희에게 release 브렌치는 짧으면 몇 주, 길면 몇 달간 방치되어있으며 배포 시 체리픽 해와야할 커밋들의 수는 상당히 큽니다. 또한 반영된 커밋과 반영되지 않은 커밋을 잘 구분지어야하는 것도 하나의 리소스라고 생각합니다.

현재는 처음 이 브렌치 전략을 적용 할 근거였던 3주 스프린트와 3개월 대형 프로젝트가 진행 중인지에 따라서 브렌치 전략을 다시 되돌리는 것이 어떨지 판단해야할 것 같습니다.


### 이후 대안
조금 더 사일로의 기조와 현황을 지켜본 뒤 대응




### 레퍼런스
https://blog.benelog.net/rethink-about-git-flow
https://blog.banksalad.com/tech/how-banksalad-safely-deploys-mobile-app/






